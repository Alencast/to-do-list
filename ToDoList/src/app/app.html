<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
  <div class="container mx-auto max-w-6xl">
    <!-- Header -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-gray-800 mb-2">{{ title() }}</h1>
      <p class="text-gray-600">Gerencie suas tarefas de forma simples e eficiente</p>
    </div>

    <!-- Toolbar -->
    <p-toolbar class="mb-6 rounded-lg shadow-sm">
      <div class="p-toolbar-group-start">
        <p-button 
          label="Nova Tarefa" 
          icon="pi pi-plus-circle" 
          class="p-button-success"
          (onClick)="openNew()"
          pTooltip="Criar uma nova tarefa"
          tooltipPosition="bottom"
          pRipple>
        </p-button>
      </div>
      <div class="p-toolbar-group-end">
        <span class="text-sm text-gray-600">
          Total: {{ todos().length }} | 
          Concluídas: {{ getCompletedCount() }}
        </span>
      </div>
    </p-toolbar>

    <!-- Lista de Tarefas -->
    <p-card class="shadow-lg rounded-lg">
      <p-table 
        [value]="todos()" 
        styleClass="p-datatable-gridlines"
        [tableStyle]="{ 'min-width': '50rem' }"
        responsiveLayout="scroll">
        
        <ng-template pTemplate="header">
          <tr>
            <th class="w-12">Status</th>
            <th>Título</th>
            <th class="w-32">Prioridade</th>
            <th class="w-32">Ações</th>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="body" let-todo>
          <tr [class.opacity-60]="todo.completed">
            <td>
              <p-checkbox 
                [binary]="true"
                [ngModel]="todo.completed"
                (onChange)="toggleCompleted(todo)">
              </p-checkbox>
            </td>
            <td>
              <span [class.line-through]="todo.completed" class="text-lg">
                {{ todo.title }}
              </span>
            </td>
            <td>
              <span 
                class="px-3 py-1 rounded-full text-sm font-medium"
                [class]="'bg-' + getPrioritySeverity(todo.priority) + '-100 text-' + getPrioritySeverity(todo.priority) + '-800'">
                {{ getPriorityLabel(todo.priority) }}
              </span>
            </td>
            <td>
              <div class="flex gap-2">
                <p-button 
                  icon="pi pi-info-circle"
                  class="p-button-rounded p-button-info p-button-sm"
                  (onClick)="viewTodo(todo)"
                  pTooltip="Ver detalhes da tarefa"
                  tooltipPosition="top"
                  pRipple>
                </p-button>
                <p-button 
                  icon="pi pi-file-edit"
                  class="p-button-rounded p-button-warning p-button-sm"
                  (onClick)="editTodo(todo)"
                  pTooltip="Editar tarefa"
                  tooltipPosition="top"
                  pRipple>
                </p-button>
                <p-button 
                  icon="pi pi-times-circle"
                  class="p-button-rounded p-button-danger p-button-sm"
                  (onClick)="deleteTodo(todo)"
                  pTooltip="Remover tarefa"
                  tooltipPosition="top"
                  pRipple>
                </p-button>
              </div>
            </td>
          </tr>
        </ng-template>
        
        <ng-template pTemplate="emptymessage">
          <tr>
            <td colspan="4" class="text-center py-8">
              <div class="text-gray-500">
                <i class="pi pi-info-circle text-3xl mb-3 block"></i>
                Nenhuma tarefa encontrada. Clique em "Nova Tarefa" para começar!
              </div>
            </td>
          </tr>
        </ng-template>
      </p-table>
    </p-card>

    <!-- Dialog para Criar/Editar -->
    <p-dialog 
      [header]="editMode() ? 'Editar Tarefa' : 'Nova Tarefa'"
      [(visible)]="showDialog"
      [modal]="true"
      [style]="{ width: '450px' }"
      [draggable]="false"
      [resizable]="false">
      
      <div class="flex flex-col gap-4">
        <div>
          <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
            Título *
          </label>
          <input 
            id="title"
            type="text" 
            pInputText 
            [(ngModel)]="newTodo.title"
            placeholder="Digite o título da tarefa"
            class="w-full" />
        </div>
        
        <div>
          <label for="priority" class="block text-sm font-medium text-gray-700 mb-2">
            Prioridade
          </label>
          <p-inputNumber
            id="priority"
            [(ngModel)]="newTodo.priority"
            [min]="1"
            [max]="3"
            [showButtons]="true"
            buttonLayout="horizontal"
            spinnerMode="horizontal"
            [step]="1"
            decrementButtonClass="p-button-secondary"
            incrementButtonClass="p-button-secondary"
            class="w-full">
          </p-inputNumber>
          <small class="text-gray-500">1 = Alta, 2 = Média, 3 = Baixa</small>
        </div>
        
        <div *ngIf="editMode()">
          <label class="flex items-center gap-2">
            <p-checkbox 
              [binary]="true"
              [(ngModel)]="newTodo.completed">
            </p-checkbox>
            <span class="text-sm font-medium text-gray-700">Tarefa concluída</span>
          </label>
        </div>
      </div>
      
      <ng-template pTemplate="footer">
        <div class="flex justify-end gap-2">
          <p-button 
            label="Cancelar" 
            icon="pi pi-ban" 
            class="p-button-text"
            (onClick)="showDialog.set(false)"
            pTooltip="Cancelar operação"
            pRipple>
          </p-button>
          <p-button 
            [label]="editMode() ? 'Atualizar' : 'Criar'"
            [icon]="editMode() ? 'pi pi-save' : 'pi pi-plus-circle'"
            (onClick)="saveTodo()"
            pTooltip="Salvar tarefa"
            pRipple>
          </p-button>
        </div>
      </ng-template>
    </p-dialog>

    <!-- Dialog de Visualização -->
    <p-dialog 
      header="Detalhes da Tarefa"
      [(visible)]="showSelectedDialog"
      [modal]="true"
      [style]="{ width: '400px' }"
      [draggable]="false"
      [resizable]="false">
      
      <div *ngIf="selectedTodo()" class="flex flex-col gap-4">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">ID</label>
          <p class="text-gray-900">{{ selectedTodo()?.id }}</p>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Título</label>
          <p class="text-gray-900">{{ selectedTodo()?.title }}</p>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Prioridade</label>
          <span 
            class="inline-block px-3 py-1 rounded-full text-sm font-medium"
            [class]="'bg-' + getPrioritySeverity(selectedTodo()?.priority || 1) + '-100 text-' + getPrioritySeverity(selectedTodo()?.priority || 1) + '-800'">
            {{ getPriorityLabel(selectedTodo()?.priority || 1) }}
          </span>
        </div>
        
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
          <span 
            class="inline-block px-3 py-1 rounded-full text-sm font-medium"
            [class]="selectedTodo()?.completed ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'">
            {{ selectedTodo()?.completed ? 'Concluída' : 'Pendente' }}
          </span>
        </div>
      </div>
      
      <ng-template pTemplate="footer">
        <div class="flex justify-end">
          <p-button 
            label="Fechar" 
            icon="pi pi-arrow-left" 
            (onClick)="closeViewDialog()"
            pTooltip="Voltar à lista de tarefas"
            pRipple>
          </p-button>
        </div>
      </ng-template>
    </p-dialog>
  </div>
</div>

<!-- Toast para notificações -->
<p-toast></p-toast>

<!-- Confirm Dialog -->
<p-confirmDialog></p-confirmDialog>

<router-outlet />
